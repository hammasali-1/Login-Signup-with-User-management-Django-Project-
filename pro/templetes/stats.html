<!DOCTYPE html>
<html lang="en" data-bs-theme="light">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>User Stats</title>
    
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        :root{--radius:.9rem}
        body{opacity:0;animation:fadeIn .15s ease forwards}
        @keyframes fadeIn{to{opacity:1}}
        .navbar{backdrop-filter:blur(6px)}
        .card{border-radius:var(--radius);box-shadow:0 10px 30px rgba(0,0,0,.08)}
        .glass{background:rgba(255,255,255,.75)}
        [data-bs-theme="dark"] .glass{background:rgba(25,25,28,.55)}
        .stat-card{padding:1rem;border-radius:var(--radius);background:var(--bs-body-bg);border:1px solid var(--bs-border-color)}
    </style>
</head>
<body style="font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif">
    {% include 'partials/navbar.html' %}
    <div id="spa-content">
    <div class="container py-4">
        <div class="row g-4">
            <div class="col-12">
                <div class="card glass p-4">
                    <h2 class="h4 mb-3">User Statistics</h2>
                    <div class="row g-3 mb-4">
                        <div class="col-6 col-md-3">
                            <div class="stat-card">
                                <div class="text-secondary">Total</div>
                                <div class="h4 mb-0">{{ total }}</div>
                            </div>
                        </div>
                        <div class="col-6 col-md-3">
                            <div class="stat-card">
                                <div class="text-secondary">Active</div>
                                <div class="h4 mb-0">{{ active }}</div>
                            </div>
                        </div>
                        <div class="col-6 col-md-3">
                            <div class="stat-card">
                                <div class="text-secondary">Inactive</div>
                                <div class="h4 mb-0">{{ inactive }}</div>
                            </div>
                        </div>
                        <div class="col-6 col-md-3">
                            <div class="stat-card">
                                <div class="text-secondary">Deleted</div>
                                <div class="h4 mb-0">{{ deleted }}</div>
                            </div>
                        </div>
                    </div>
                    <div class="row g-4">
                        <div class="col-12 col-lg-6">
                            <div class="p-3 border rounded-3">
                                <h5 class="mb-3">Role Distribution{% if current_role == 'manager' %} (Users only){% endif %}</h5>
                                <canvas id="roleChart" height="220"></canvas>
                            </div>
                        </div>
                        <div class="col-12 col-lg-6">
                            <div class="p-3 border rounded-3">
                                <h5 class="mb-3">Account Status</h5>
                                <canvas id="statusChart" height="220"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    </div>
    <script data-spa-init>
        (function(){
            if(typeof Chart==='undefined') return;
            var roleLabels = [{% if current_role == 'admin' %}'Admin','Manager','User'{% else %}'User'{% endif %}];
            var roleData = [{% if current_role == 'admin' %}{{ role_counts.admin }}, {{ role_counts.manager }}, {{ role_counts.user }}{% else %}{{ role_counts.user }}{% endif %}];
            var roleCtx = document.getElementById('roleChart');
            if(roleCtx){
                var rctx = roleCtx.getContext('2d');
                new Chart(rctx, {type:'pie', data:{labels:roleLabels, datasets:[{data:roleData, backgroundColor:['#6366F1','#22D3EE','#10B981']}]} , options:{responsive:true, plugins:{legend:{position:'bottom'}}}});
            }
            var sctxEl = document.getElementById('statusChart');
            if(sctxEl){
                var sctx = sctxEl.getContext('2d');
                new Chart(sctx, {type:'bar', data:{labels:['Active','Inactive','Deleted'], datasets:[{data:[{{ active }}, {{ inactive }}, {{ deleted }}], backgroundColor:['#22D3EE','#6366F1','#EF4444']}]} , options:{responsive:true, plugins:{legend:{display:false}}}});
            }
        })();
    </script>
    <div id="pageLoader"><div class="spinner-border text-primary" role="status" aria-label="Loading"></div></div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function(){});
    </script>
    <script>
        (function(){
            var roleLabels = [{% if current_role == 'admin' %}'Admin','Manager','User'{% else %}'User'{% endif %}];
            var roleData = [{% if current_role == 'admin' %}{{ role_counts.admin }}, {{ role_counts.manager }}, {{ role_counts.user }}{% else %}{{ role_counts.user }}{% endif %}];
            var roleCtx = document.getElementById('roleChart').getContext('2d');
            new Chart(roleCtx, {
                type: 'pie',
                data: {
                    labels: roleLabels,
                    datasets: [{
                        data: roleData,
                        backgroundColor: ['#6366F1','#22D3EE','#10B981']
                    }]
                },
                options: {responsive:true, plugins:{legend:{position:'bottom'}}}
            });

            var statusCtx = document.getElementById('statusChart').getContext('2d');
            new Chart(statusCtx, {
                type: 'bar',
                data: {
                    labels: ['Active','Inactive','Deleted'],
                    datasets: [{
                        label: 'Count',
                        data: [{{ active }}, {{ inactive }}, {{ deleted }}],
                        backgroundColor: ['#10B981','#9CA3AF','#EF4444']
                    }]
                },
                options: {
                    responsive:true,
                    plugins:{legend:{display:false}},
                    scales:{y:{beginAtZero:true, precision:0}}
                }
            });
        })();
    </script>
</body>
</html>
